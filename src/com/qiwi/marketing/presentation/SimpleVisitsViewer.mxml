<?xml version="1.0"?>
<!--
  Created by v.pavkin on 18.04.2014.
-->
<presentation:PageBase xmlns:s="library://ns.adobe.com/flex/spark"
					   xmlns:fx="http://ns.adobe.com/mxml/2009"
					   xmlns:presentation="com.qiwi.marketing.presentation.*">

	<fx:Script><![CDATA[
		import com.qiwi.marketing.data.storage.LocalStorage;
		import com.qiwi.marketing.data.storage.VisitsStorageManager;
		import com.qiwi.marketing.project.Project;
		import com.qiwi.marketing.project.visit.DayOfVisits;

		private var _localStorage:LocalStorage = LocalStorage.instance;

		[Bindable]
		private var _project:Project;

		private var _selectedDate:String;

		override protected function onShow(e:Event = null):void {
			title = "Simple Stats Viewer: «" + (_project = Context.currentProject).displayName + "»";
			//progressBar.value = .4;
			trace("init SVV")
		}

		private function onSelectedDateChanged():void {
			trace("onSelectedDateChanged")
			if (dateComboBox.selectedItem && dateComboBox.selectedItem != _selectedDate) {
				_selectedDate = dateComboBox.selectedItem;
				var dv:DayOfVisits = _project.visits[_selectedDate];
				if (!dv.isLoaded) {
					dv.visits = VisitsStorageManager.instance.loadVisits(_project, _selectedDate);
					dv.isLoaded = true;
				}
				viewer.text = DayOfVisits(_project.visits[_selectedDate]).visits[0].path.pathString;
			}
		}
		private function onBackButtonClick():void {
			dispatchEvent(new Event("open_project", true));
		}
		]]></fx:Script>

	<s:VGroup height="100%">
		<s:HGroup gap="20">
			<s:Label text="Choose date:"/>
			<s:ComboBox id="dateComboBox" dataProvider="{_project.datesAvailable}" requireSelection="false"
						change="onSelectedDateChanged()"/>
			<!--<components:ProgressBar id="progressBar"-->
			<!--skinClass="com.qiwi.marketing.presentation.skins.ProgressBarSkin"/>-->
		</s:HGroup>
		<s:TextArea id="viewer" width="100%" height="100%" text="No date selected..."/>
		<s:Button label="Back to board" click="onBackButtonClick()"/>
	</s:VGroup>
</presentation:PageBase>
